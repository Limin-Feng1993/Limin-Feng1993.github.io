---
layout:     post                  
title:    基于图网络的物理模拟器
subtitle: 
date:       2020-08-10
author:     Limin                    
header-img: img/Fox.jpg    
catalog: true                     
tags:                             
    - 读书笔记
---

&nbsp; Google公司DeepMind实验室于2020年2月21日在arxiv上发布了预印版文章《Learning to Simulate Complex Physics with Graph Networks》。研究人员提出了模拟复杂物理过程的一般框架，包括流体、刚性固体和可变形材料的相互作用。这个框架称之为 "基于图网络的模拟器"(Graph Network-based Simulators, GNS)。该框架以图中的节点来表示物理系统的状态，并通过学习信息传递 (message -passing) 过程来计算节点的动态。该模型可以预测数千个粒子的状态。输入不同的初始条件，可以预测数千个时间步长的粒子变化。决定该模型长期性能的主要因素是信息传递的步数，以及通过人为加入噪声破坏训练数据，以此减轻错误的积累，防止过拟合。作者声称GNS框架是迄今为止最精确的、最通用的物理模拟器。

![GNS模型的输出。它以足够的分辨率来模拟丰富的流体和刚体材料，可以用来实现高质量的渲染。](https://upload-images.jianshu.io/upload_images/17085473-2439dba2cd81051c.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

&nbsp;  对现实世界中的复杂物理过程进行模拟，是许多学科非常重要的组成部分，例如工程力学、地球科学等。然而传统的模拟器在创建和使用上非常昂贵。以欧洲中期天气预报中心ECMWF和美国大气与海洋局NOAA为例，它们必须在预测时段之前计算出全球高分辨率的气象和海洋状态，否则预测就失去了意义。因此多台超级计算机以及配套的电力设施一刻不停的运转。其中，P级“超级计算机”每秒理论运算速度超过2000万亿次。可想而知，其预报产品耗资颇巨。因此，中国气象局每年要花费几亿元人民币购买ECMWF的气象预报产品 (ECMWF预测所用差分方法较为先进)。由于海洋和大气一样都是粘性流体，对流体力学进行高质量的模拟需要大量的计算资源，这使得扩大其适用范围变得非常困难。

&nbsp;  构建一个模拟器可能需要多年的努力，并且通常其适用的过程必须设置在狭窄的范围内，也就是以通用性换取准确性。例如中尺度气象模式WRF，是美国环境预测中心NCEP、美国国家大气研究中心NCAR等科研机构在二战后各国气象模式的基础上，于2000 年开发出了中尺度天气预报WRF模式，并不断更新了二十年，修复里面的错误和优化。WRF模式的运行debug是很多人噩梦。在运行气象模式时，每个研究研究人员都要根据自己的研究区域和问题自己调节模式参数，来得到准确的结果，期间牺牲了通用性。

&nbsp;  即使是最好的模拟器，由于对底层物理过程的了解不够和参数设置的混乱，往往也不准确。例如，虽说传统的数值模式一向瞧不起深度学习的瞎调参，但是大气数值模式在选择云雾理和边界层方案时，也是通过不断调整参数来获得最优结果的。不同点在于，深度学习是后调参，数值模式是先调参。

&nbsp; 替代传统模拟器的一个有吸引力的方法是使用机器学习直接从观察到的数据中训练模拟器，然而庞大的时间、空间维度和复杂的动力学过程一直是标准的端到端学习方法难以克服的。空间和时间维度是地球科学的显著特征，而复杂的动力学过程是传统数值模式赖以成名的资本和支柱。

&nbsp;  文章作者提出了一个从时空四维数据中学习并模拟的通用框架"基于图网络的模拟器" (GNS)。这个框架施加了强烈的归纳偏差 (inductive biases)，其中丰富的物理状态由粒子间相互作用的图结构，也就是节点之间的信息传递来近似。  

![信息传播网络 message -passing network。](https://upload-images.jianshu.io/upload_images/17085473-075e9363bb8a4a78.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

&nbsp;  GNS的模拟过程是Encode-process-decode (编码-处理解码)、End-to-end (端到端)、Message-passing network (信息传递) 三合一模型。GNS使用其学习得到的动力学模型dθ和固定的更新编码器来预测粒子的未来状态。dθ使用 "编码-处理-解码 "方案，从输入状态X中计算动态信息Y。首先，编码器 (ENCODER) 从输入状态X中构建潜在的图结构G0，然后处理器 (PROCESSOR) 在G0上执行M轮信息传递网络的学习G0，G1，．．．， GM。最后解码器 (DECODER) 从最终的图结构GM中提取动态信息Y。

![GNS的模拟过程是Encode-process-decode、End-to-end、Message-passing network三合一模型。](https://upload-images.jianshu.io/upload_images/17085473-b20538e15c7d6e0d.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

&nbsp; 文章使用的模拟器为基于粒子的模拟，它被广泛应用计算流体动力学，计算机图形学。动力学过程是根据粒子在其局部邻域内的相互作用来计算的。常见的基于粒子的流体模拟方法是 "平滑粒子流体力学"(smoothed particle hydrodynamics, SPH)，它评估每个粒子周围的压力和粘度力，并相应地更新粒子的速度和位置。其他技术，如 "基于位置的动力学"(PBD)和 "材料点法"(MPM)，更适合于相互作用的可变形材料。在PBD中，不可压缩性和碰撞动力学涉及解决粒子之间的对偶距离约束，并直接预测其位置变化。最近出现了一些更便捷的基于粒子的可微分仿真引擎，如[DiffTaichi](https://github.com/yuanming-hu/difftaichi)。  

&nbsp; 图形网络(GN)是一种类型的图形神经网络，最近被证明在学习涉及许多实体之间相互作用中非常有效。GN将输入图映射到具有相同结构但节点、边缘和图级属性可能不同的输出图，并且可以被训练成学习消息传递的形式，使信息通过边缘在节点之间传播。GN可以[模拟刚体、质点弹簧以及机器人控制系统](https://github.com/fxia22/gn.pytorch)。机器如果想达到和人类一样的智慧，那么存储在机器中的知识就不应该是现在这种线性的、规则的数据，例如矩阵或者向量的形式，而应该是像人类大脑中的知识一样以图结构的形式存储。脑能模拟各种复杂运动，靠的是神经网络，而不是复杂的力学公式。

&nbsp; 作者采用基于粒子的方法，用粒子之间的能量和动量交互来表示动力学过程。而在实际应用场景中，物理过程往往都很复杂，例如上层大气是混沌非线性的，而边界层内的大气是摩擦力参与的。对于大气这种复杂系统，长时间步长的模拟会导致误差累积，亦即引入了计算噪声。一般来讲，模拟超过300个时间步长后，计算误差会导致数学物理方程无法收敛。所以不能单纯的将上一步的计算结果作为输入来预测下一个时刻的状态。可以引入随机散步噪声来减弱计算误差。

![信息传输模型的三步走策略：编码、处理、解码。可以看出，它只关心节点的状态。但是在科学研究中，我们其实也关心连边，亦即因果关系也是很重要的 (要不然怎么发Paper）。](https://upload-images.jianshu.io/upload_images/17085473-c47b13f65300aaa0.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

> 实际上，语言系统和物理系统一样复杂，难以总结出普适性的规律。所以说，自然语言是一种非常低效的知识表示方式。


